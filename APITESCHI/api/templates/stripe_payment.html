{% load static %}
<!-- stripe_payment.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Stripe Payment</title>
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <h1>Realizar Pago</h1>
    <!-- stripe_payment.html -->
<form id="payment-form" method="POST">
    {% csrf_token %}
    <div>
        <label for="amount">Cantidad a Pagar:</label>
        <input type="text" id="amount" name="amount" placeholder="Ingrese la cantidad">
    </div>
    <div>
        <label for="card_number">Número de Tarjeta:</label>
        <input type="text" id="card_number" placeholder="**** **** **** ****">
    </div>
    <div>
        <label for="expiry">Fecha de Vencimiento:</label>
        <input type="text" id="expiry" placeholder="MM/YY">
    </div>
    <div>
        <label for="cvc">CVC:</label>
        <input type="text" id="cvc" placeholder="CVC">
    </div>
    <button id="submit-button">Pagar</button>
</form>

<script src="https://js.stripe.com/v3/"></script>
<script>
    var stripe = Stripe('{{ STRIPE_PUBLIC_KEY }}');
    var elements = stripe.elements();
    var cardElement = elements.create('card');

    cardElement.mount('#card_number');

    var form = document.getElementById('payment-form');
    var submitButton = document.getElementById('submit-button');

    form.addEventListener('submit', function (event) {
        event.preventDefault();

        stripe.createToken(cardElement).then(function (result) {
            if (result.error) {
                // Informar al usuario sobre errores en la tarjeta
                // Puedes mostrar un mensaje de error en la interfaz de usuario
            } else {
                // Enviar el token al servidor para procesar el pago
                handlePayment(result.token);
            }
        });
    });

    function handlePayment(token) {
        var amount = document.getElementById('amount').value;

        fetch('/your-payment-endpoint/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                amount: amount,
                token: token.id
            })
        })
        .then(response => response.json())
        .then(data => {
            // Manejar la respuesta del servidor
            console.log(data);
        });
    }

    // Función para obtener el valor de la cookie CSRF
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>

</body>
</html>
